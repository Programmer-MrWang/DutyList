# DutyList · 值日生名单

ClassIsland 插件 · 在主界面实时显示当前时段的值日生信息

---

## 功能

- **批次轮换**：支持多个批次按天数间隔循环切换，适合九组劳动值日、值日班长等多种场景
- **按批次第几天配置**：取代旧版的"按星期配置"，每个批次内按第1天、第2天……独立设置
- **自定义跳过日期**：可对每个批次单独指定跳过周一到周日中的任意几天（如跳过周六、周日）
- **按时间段分组**：同一天可设置多个时间段（如上午打扫、下午擦黑板），仅显示当前时段
- **精确时段提醒**：预读当天所有时间段，到点即触发提醒，无轮询延迟；支持批次级别独立开关
- **TTS 语音朗读**：提醒时自动朗读值日内容，支持指定 Azure 语音名称（如 `zh-CN-XiaoxiaoNeural`）
- **自定义颜色**：每个值日项目可单独选取颜色，在主界面一眼区分
- **多人员支持**：每个项目最多可填写 3 名人员
- **数据导入 / 导出**：支持导出新版 JSON、导入新版 JSON（批次追加）、导入并自动迁移旧版 `duty.json`
- **立即刷新**：设置页一键推送最新配置到主界面组件，无需等待下次自动刷新
- **配置自动保存**：修改即保存，下次启动自动恢复

## 显示效果

主界面组件以横排形式展示，每个值日项目左上角标注所属时段：

```
08:00–12:00        08:00–12:00        14:00–17:00
打扫卫生：小明、小红   │   擦黑板：小李   │   倒垃圾：小张
```

## 安装

1. 在 [Releases](../../releases) 页面下载最新 `.cipx` 插件包
2. 在 ClassIsland **应用设置 → 插件 → 已安装** 中点击右上角 **···** → **从文件安装**
3. 选择下载的 `.cipx` 文件，重启后生效

## 配置

安装并启用插件后，进入 **应用设置 → DutyList 设置** 进行配置：

### 值日表 Tab

| 操作 | 说明 |
|---|---|
| 起始日期 / 每批天数 | 设置第一批次从哪天开始，以及每批持续几天 |
| 新建批次 | 点击「新建批次」，系统自动命名为「第N批」 |
| 选择批次 | 从下拉框切换要编辑的批次 |
| 本批次选项 | 可独立开启/关闭提醒；可选择需要跳过的星期几（支持多选） |
| 编辑某天 | 在天数总览表中点击「编辑」，展开该天的时间段编辑面板 |
| 添加时间段 | 填写开始 / 结束时间（HH:mm，24 小时制） |
| 添加项目 | 填写项目名称、人员（最多 3 人）、项目颜色 |
| 保存 | 点击「保存」按钮，或修改内容后自动保存 |
| 立即刷新 | 点击右上角「↻ 立即刷新」，立即推送到主界面 |

### 设置 Tab

| 操作 | 说明 |
|---|---|
| 全局提醒开关 | 关闭后所有批次均不发提醒 |
| 语音朗读 | 开启后在提醒时用 TTS 朗读值日内容 |
| TTS 语音名称 | 留空使用系统默认；可填写 Azure Neural 语音名（如 `zh-CN-XiaoxiaoNeural`），也可从预设下拉中选择 |
| 导出配置 | 将当前配置导出为新版 JSON 文件 |
| 导入配置 | 导入之前导出的新版 JSON，批次将追加到当前配置 |
| 导入旧版 | 选取旧版 `duty.json`，自动迁移为新版批次格式（周一→第1天…周日→第7天） |
| 重置配置 | 清空所有批次和设置（不可恢复） |

## 在主界面添加组件

1. 进入 **应用设置 → 组件**
2. 在组件库中找到「值日生名单」
3. 将其拖动到主界面的任意插槽中

## 场景参考

**劳动值日（9 组循环，每天一组）**
- 新建 1 个批次，每批持续 **9 天**
- 第1天配置第1组，第2天配第2组……以此类推
- 不勾选跳过任何日期

**值日班长（花名册顺序，两人一天，跳过周日）**
- 新建 1 个批次，每批持续天数 = 花名册总人数 / 2
- 每天填写对应的 2 名同学
- 勾选跳过「周日」

## 开发信息

| 项目 | 内容 |
|---|---|
| 插件 ID | `dutylist.jimmyxiao` |
| 版本 | `1.1.0.0` |
| 目标 API 版本 | `2.0.0.0` |
| 运行时 | .NET 8 / Avalonia（不含运行时，依赖 ClassIsland 本体） |
| 配置文件路径 | `%AppData%\ClassIsland\Plugins\dutylist.jimmyxiao\duty.json` |

## 更新日志

### 1.1.0.0

**新增**
- 间周批次轮换系统：支持多批次、不规则日期轮换，彻底取代原有的"按星期配置"模式
- 批次第几天配置：每批次内按天数（第1天、第2天……）独立设置值日信息
- 自定义跳过日期：每个批次可选择跳过周一至周日中的任意几天
- 批次级提醒开关：每个批次可独立开启/关闭提醒
- TTS 语音模型选择：支持指定 Azure Neural 语音名称，内置 4 个常用预设
- 精确时段触发：预读配置，到点即触发，无 30 秒轮询延迟
- 数据导入功能：支持导入新版 JSON 配置（批次追加）
- 立即刷新按钮：一键推送最新配置到主界面组件
- 设置界面动画：卡片交错淡入、面板展开/折叠过渡、行 hover 高亮、按钮缩放反馈

**优化**
- 设置界面重新设计：天数总览表格形式，内联编辑面板，更直观的批次管理
- 编译产物不再包含 .NET 运行时，插件体积大幅减小

**修复**
- 旧版数据格式自动迁移（周一→第1天…周日→第7天），无需手动转换
- 修复 CS1003 弯引号编译错误
- 修复迁移器对已废弃 `WeekConfig` 的空引用警告（CS8602）

### 1.0.0.1 及以前

- 按星期配置值日信息
- 多时间段支持
- 自定义项目颜色
- 配置自动保存与旧版格式迁移

## 许可证

MIT License
